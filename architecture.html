<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="img/favicon.ico">
  <title>Architecture - Alternative Haskell Infrastructure for Nixpkgs</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="css/theme.css" />
  <link rel="stylesheet" href="css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Architecture";
    var mkdocs_page_input_path = "architecture.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="js/jquery-2.1.1.min.js" defer></script>
  <script src="js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="index.html" class="icon icon-home"> Alternative Haskell Infrastructure for Nixpkgs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="index.html">Introduction</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="motivation.html">Motivation</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="architecture.html">Architecture</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#nix-tools">nix-tools</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#haskellnix">haskell.nix</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#hackagenix">hackage.nix</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#stackagenix">stackage.nix</a>
    </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Tutorials</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="tutorials/getting-started.html">Getting started</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="tutorials/getting-started-flakes.html">Getting started with Flakes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="tutorials/getting-started-hix.html">Getting started with Hix</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="tutorials/development.html">Creating a development environment</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="tutorials/clean-git.html">Sourcing files only part of git repository using cleanGit</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="tutorials/source-repository-hashes.html">Handling git repositories in projects</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="tutorials/pkg-map.html">Mapping non-Haskell dependencies to Nixpkgs</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="tutorials/hackage-stackage.html">Bumping Hackage and Stackage snapshots</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="tutorials/materialization.html">Materialization: Speeding up Nix evaluation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="tutorials/cross-compilation.html">Cross-compiling your project</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="tutorials/coverage.html">Generating coverage information</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="tutorials/building-package-from-stackage-hackage.html">Build a specific package from Hackage or Stackage</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="tutorials/ca-derivations.html">Content addressed derivations</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Reference</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="reference/supported-ghc-versions.html">Supported GHC versions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="reference/commands.html">Command-line tools</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="reference/library.html">Haskell.nix Library</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="reference/modules.html">Module options</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Templates / Abstraction</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="iohk-nix.html">IOHKs nix library</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Dev Notes</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="dev/dev-architecture.html">Architecture</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="dev/installing-nix-tools.html">Installing nix-tools</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="dev/nix-tools-pin.html">How to update nix-tools</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="dev/manually-generating-nix-expressions.html">Manually generating Nix expressions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="dev/maintainer-scripts.html">Maintainer Scripts</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="dev/nixpkgs-pin.html">Nixpkgs Pin</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="dev/removing-with-package-wrapper.html">Removing withPackage wrapper</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="dev/tests.html">Test Suite</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="dev/adding-new-ghc.html">Adding a new GHC version</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="dev/coverage.html">Coverage</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="dev/hix.html">Making changes to Hix</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="changelog.html">ChangeLog</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Alternative Haskell Infrastructure for Nixpkgs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
    
      
    
    <li>Architecture</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/input-output-hk/haskell.nix/edit/master/docs/architecture.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="architecture">Architecture<a class="headerlink" href="#architecture" title="Permanent link">&para;</a></h1>
<p>There are multiple components that play a part in the haskell.nix
infrastructure.  These are <code>nix-tools</code>, <code>haskell.nix</code>, <code>hackage.nix</code>,
and <code>stackage.nix</code>.</p>
<pre><code class="language-no-highlight">                                             .-------------.     .-------------.
.- nix-tools ------.                         | haskell.nix |  .- | hackage.nix |
| .--------------. |   .----------------.    '-------------'  |  '-------------'
| | stack-to-nix |---&gt; | stack-pkgs.nix |-.         |         |         |
| '--------------' |   '----------------' |         v         |         v
| .-------------.  |   .----------.       '--&gt; .----------. &lt;-'  .--------------.
| | plan-to-nix |----&gt; | plan.nix |------.---&gt; | pkgs.nix | &lt;--- | stackage.nix |
| '-------------'  |   '----------'      |     '----------'      '--------------'
| .--------------. |   .--------------.  |          |
| | cabal-to-nix |---&gt; | $package.nix |--'          v
| '--------------' |   '--------------'       .-------------.
'------------------'                          | default.nix |
                                              '-------------'
                                                    |
                                                    v
                                              .-------------.
                                              | release.nix |
                                              '-------------'
</code></pre>
<p>haskell.nix diagram</p>
<h2 id="nix-tools"><a href="https://github.com/input-output-hk/nix-tools">nix-tools</a><a class="headerlink" href="#nix-tools" title="Permanent link">&para;</a></h2>
<p>nix-tools is a Haskell package that provides the following tools:</p>
<ul>
<li>
<p><code>cabal-to-nix</code>: a <code>.cabal</code> to <code>.nix</code> transformer that retains
  conditional expressions.</p>
</li>
<li>
<p><code>stack-to-nix</code>: a <code>stack.yaml</code> to <code>.nix</code> transformer that will read
  in a <code>stack.yaml</code> expression an generate a <code>pkgs.nix</code> file suited for
  use with <code>haskell.nix</code>.</p>
</li>
<li>
<p><code>plan-to-nix</code>: a <code>plan.json</code> to <code>.nix</code> transformer that will read in
  a <code>plan.json</code> file and generate a <code>pkgs.nix</code> file suited for use
  with <code>haskell.nix</code>.</p>
</li>
</ul>
<p>as well as a few other tools used to generate <code>hackage.nix</code> and <code>stackage.nix</code>.</p>
<h2 id="haskellnix"><a href="https://github.com/input-output-hk/haskell.nix">haskell.nix</a><a class="headerlink" href="#haskellnix" title="Permanent link">&para;</a></h2>
<p><a href="https://github.com/input-output-hk/haskell.nix">Haskell.nix</a> is the runtime system for this Haskell infrastructure.
It contains the component builder, as well as the system package and
license mapping.  Without haskell.nix the expressions generated by
either of the <code>nix-tools</code> tools make little sense on their own.</p>
<h2 id="hackagenix"><a href="https://github.com/input-output-hk/hackage.nix">hackage.nix</a><a class="headerlink" href="#hackagenix" title="Permanent link">&para;</a></h2>
<p><a href="https://github.com/input-output-hk/hackage.nix">hackage.nix</a> provides all cabal expressions from hackage as nix
expressions.  It is periodically updated to keep in sync with the set
of packages available on hackage.</p>
<h2 id="stackagenix"><a href="https://github.com/input-output-hk/stackage.nix">stackage.nix</a><a class="headerlink" href="#stackagenix" title="Permanent link">&para;</a></h2>
<p><a href="https://github.com/input-output-hk/stackage.nix">stackage.nix</a> is similar to hackage.nix but provides all stackage
snapshots (lts, and nightly) as nix expressions.  It naturally depends
on hackage.nix to resolve package names, versions and revisions to the
respective packages from hackage.nix.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tutorials/getting-started.html" class="btn btn-neutral float-right" title="Getting started">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="motivation.html" class="btn btn-neutral" title="Motivation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/input-output-hk/haskell.nix/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="motivation.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="tutorials/getting-started.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '.';</script>
    <script src="js/theme_extra.js" defer></script>
    <script src="js/theme.js" defer></script>
      <script src="search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
