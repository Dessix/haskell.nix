<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Getting started - Alternative Haskell Infrastructure for Nixpkgs</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Getting started";
        var mkdocs_page_input_path = "tutorials/getting-started.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Alternative Haskell Infrastructure for Nixpkgs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Introduction</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../motivation/">Motivation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../architecture/">Architecture</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Tutorials</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Getting started</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#setting-up-the-binary-cache">Setting up the binary cache</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#niv">Niv</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#scaffolding">Scaffolding</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#working-with-a-project">Working with a project</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-haskellnix-without-niv">Using haskell.nix without Niv</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#going-forward">Going forward</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../getting-started-flakes/">Getting started with Flakes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../getting-started-hix/">Getting started with Hix</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/">Creating a development environment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../clean-git/">Sourcing files only part of git repository using cleanGit</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../source-repository-hashes/">Handling git repositories in projects</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../pkg-map/">Mapping non-Haskell dependencies to Nixpkgs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../hackage-stackage/">Bumping Hackage and Stackage snapshots</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../materialization/">Materialization: Speeding up Nix evaluation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cross-compilation/">Cross-compiling your project</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../coverage/">Generating coverage information</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../building-package-from-stackage-hackage/">Build a specific package from Hackage or Stackage</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ca-derivations/">Content addressed derivations</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/supported-ghc-versions/">Supported GHC versions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/commands/">Command-line tools</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/library/">Haskell.nix Library</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/modules/">Module options</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/">Troubleshooting</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Templates / Abstraction</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../iohk-nix/">IOHKs nix library</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Dev Notes</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../dev/dev-architecture/">Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../dev/installing-nix-tools/">Installing nix-tools</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../dev/nix-tools-pin/">How to update nix-tools</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../dev/manually-generating-nix-expressions/">Manually generating Nix expressions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../dev/maintainer-scripts/">Maintainer Scripts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../dev/nixpkgs-pin/">Nixpkgs Pin</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../dev/removing-with-package-wrapper/">Removing withPackage wrapper</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../dev/tests/">Test Suite</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../dev/adding-new-ghc/">Adding a new GHC version</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../dev/coverage/">Coverage</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../dev/hix/">Making changes to Hix</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../changelog/">ChangeLog</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Alternative Haskell Infrastructure for Nixpkgs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Tutorials &raquo;</li><li>Getting started</li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://github.com/input-output-hk/haskell.nix/edit/master/docs/tutorials/getting-started.md"
          class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="getting-started">Getting started<a class="headerlink" href="#getting-started" title="Permanent link">&para;</a></h1>
<p><code>haskell.nix</code> can automatically translate your
<a href="https://cabal.readthedocs.io/en/latest/cabal-project.html">Cabal</a>
or <a href="https://docs.haskellstack.org/en/stable/README/#quick-start-guide">Stack</a>
project and its dependencies into Nix code.</p>
<p>Assuming you have <a href="https://nixos.org/download.html">Nix</a> installed, you can
start setting up your project.</p>
<h2 id="setting-up-the-binary-cache">Setting up the binary cache<a class="headerlink" href="#setting-up-the-binary-cache" title="Permanent link">&para;</a></h2>
<p>IMPORTANT: you <em>must</em> do this or you <em>will</em> build several copies of GHC!</p>
<p>You can configure Nix to use our binary cache, which is pushed to by CI, so should contain the artifacts that you need.</p>
<p>You need to add the following sections to <code>/etc/nix/nix.conf</code> or, if you are a trusted user, <code>~/.config/nix/nix.conf</code> (if you don't know what a "trusted user" is, you probably want to do the former). <code>[...]</code> denote any existing entries.</p>
<pre><code>trusted-public-keys = [...] hydra.iohk.io:f/Ea+s+dFdN+3Y/G+FDgSq+a5NEWhJGzdjvKNGv0/EQ= [...]
substituters = [...] https://cache.iog.io [...]
</code></pre>
<p>If you're running NixOS, you need to add/update the following in your <code>/etc/nixos/configuration.nix</code> files instead.</p>
<pre><code># Binary Cache for Haskell.nix
nix.settings.trusted-public-keys = [
  &quot;hydra.iohk.io:f/Ea+s+dFdN+3Y/G+FDgSq+a5NEWhJGzdjvKNGv0/EQ=&quot;
];
nix.settings.substituters = [
  &quot;https://cache.iog.io&quot;
];
</code></pre>
<p>NixOS-21.11 and older use slightly different settings.</p>
<pre><code># Binary Cache for Haskell.nix  
nix.binaryCachePublicKeys = [
  &quot;hydra.iohk.io:f/Ea+s+dFdN+3Y/G+FDgSq+a5NEWhJGzdjvKNGv0/EQ=&quot;
];
nix.binaryCaches = [
  &quot;https://cache.iog.io&quot;
];   
</code></pre>
<p>This can be tricky to get setup properly. If you're still having trouble getting cache hits, consult the corresponding <a href="../../troubleshooting/#why-am-i-building-ghc">troubleshooting section</a>.</p>
<h2 id="niv">Niv<a class="headerlink" href="#niv" title="Permanent link">&para;</a></h2>
<p><a href="https://github.com/nmattia/niv">Niv</a> is a command line tool for keeping track of Nix project dependencies.</p>
<p>This guide assumes that the <code>sources.haskellNix</code> will be set to point
a pinned copy of the haskell.nix github repo.  One easy way to do this
is to use Niv.  If you prefer not to use Niv another option is described
in the in the "Using haskell.nix without niv" section of this document.</p>
<p>If you want to use Nix Flakes to pin your dependencies then you should
consider following the <a href="../getting-started-flakes/">Getting started with flakes</a>
document instead of this one.</p>
<p>After installing niv you can initialize niv and pin the latest haskell.nix
commit by running the following in the root directory of the project:</p>
<pre><code>niv init
niv add input-output-hk/haskell.nix -n haskellNix
</code></pre>
<p>Then when you want to update to the latest version of haskellNix use:</p>
<pre><code>niv update haskellNix
</code></pre>
<h2 id="scaffolding">Scaffolding<a class="headerlink" href="#scaffolding" title="Permanent link">&para;</a></h2>
<p>The following work with <code>stack.yaml</code> and <code>cabal.project</code> based
projects.</p>
<p>Add <code>default.nix</code>:</p>
<pre><code class="language-nix">let
  # Read in the Niv sources
  sources = import ./nix/sources.nix {};
  # If ./nix/sources.nix file is not found run:
  #   niv init
  #   niv add input-output-hk/haskell.nix -n haskellNix

  # Fetch the haskell.nix commit we have pinned with Niv
  haskellNix = import sources.haskellNix {};
  # If haskellNix is not found run:
  #   niv add input-output-hk/haskell.nix -n haskellNix

  # Import nixpkgs and pass the haskell.nix provided nixpkgsArgs
  pkgs = import
    # haskell.nix provides access to the nixpkgs pins which are used by our CI,
    # hence you will be more likely to get cache hits when using these.
    # But you can also just use your own, e.g. '&lt;nixpkgs&gt;'.
    haskellNix.sources.nixpkgs-unstable
    # These arguments passed to nixpkgs, include some patches and also
    # the haskell.nix functionality itself as an overlay.
    haskellNix.nixpkgsArgs;
in pkgs.haskell-nix.project {
  # 'cleanGit' cleans a source directory based on the files known by git
  src = pkgs.haskell-nix.haskellLib.cleanGit {
    name = &quot;haskell-nix-project&quot;;
    src = ./.;
  };
  # Specify the GHC version to use.
  compiler-nix-name = &quot;ghc8107&quot;; # Not required for `stack.yaml` based projects.
}
</code></pre>
<div class="admonition note">
<p class="admonition-title">git dependencies</p>
<p>If you have git dependencies in your project, you'll need
to <a href="../source-repository-hashes/">calculate sha256 hashes for them</a>.</p>
</div>
<h3 id="working-with-a-project">Working with a project<a class="headerlink" href="#working-with-a-project" title="Permanent link">&para;</a></h3>
<p>Top-level attributes are Haskell packages (incl. dependencies) part of your project.</p>
<p>To build the library component of a package in the project run:</p>
<pre><code class="language-shell">nix-build -A your-package-name.components.library
</code></pre>
<p>There are also other components such as <code>exes</code>, <code>tests</code>, <code>benchmarks</code> and <code>all</code>.
To build an executable:</p>
<pre><code class="language-shell">nix-build -A your-package-name.components.exes.your-exe-name
</code></pre>
<p>To cross compile use the <code>projectCross</code> attribute:</p>
<pre><code>nix-build -A projectCross.ghcjs.hsPkgs.your-package-name.components.exes.your-exe-name
nix-build -A projectCross.mingwW64.hsPkgs.your-package-name.components.exes.your-exe-name
</code></pre>
<p>To open a shell for use with <code>cabal</code>, <code>hlint</code> and <code>haskell-language-server</code> add <code>shell.nix</code>:</p>
<pre><code class="language-nix">(import ./default.nix).shellFor {
  tools = {
    cabal = &quot;3.2.0.0&quot;;
    hlint = &quot;latest&quot;;
    haskell-language-server = &quot;latest&quot;;
  };
}
</code></pre>
<p>Then run:</p>
<pre><code class="language-shell">nix-shell
cabal new-repl your-package-name:library:your-package-name
cabal new-build your-package-name
</code></pre>
<p>To open a shell for use with <code>stack</code> see <a href="https://github.com/input-output-hk/haskell.nix/issues/689#issuecomment-643832619">the following issue</a>.</p>
<h2 id="using-haskellnix-without-niv">Using haskell.nix without Niv<a class="headerlink" href="#using-haskellnix-without-niv" title="Permanent link">&para;</a></h2>
<p>If you would prefer not to use niv you can replace
<code>sources = import ./nix/sources.nix {};</code> in the examples with:</p>
<pre><code class="language-nix">let sources = {
    haskellNix = builtins.fetchTarball &quot;https://github.com/input-output-hk/haskell.nix/archive/master.tar.gz&quot;;
  };
</code></pre>
<p>The <code>fetchTarball</code> call above will always get the latest version, and is
similar to an auto-updating Nix channel.</p>
<p>However, in your own project, you may wish to pin <a href="https://github.com/input-output-hk/haskell.nix">haskell.nix</a> (as
you would pin Nixpkgs). This will make your builds reproducible, more
predictable, and faster (because the fixed version is cached).</p>
<p>Straightforward way of doing this is to change the branch name to a revision.</p>
<pre><code class="language-nix">let sources = {
    haskellNix = builtins.fetchTarball &quot;https://github.com/input-output-hk/haskell.nix/archive/f1a94a4c82a2ab999a67c3b84269da78d89f0075.tar.gz&quot;;
  };
</code></pre>
<p>There are other possible schemes for pinning. See
<a href="../hackage-stackage/">Bumping Hackage and Stackage snapshots</a> and
<a href="https://nix.dev/tutorials/towards-reproducibility-pinning-nixpkgs.html">Nix tutorial on reproducibility using pinning</a>.</p>
<h2 id="going-forward">Going forward<a class="headerlink" href="#going-forward" title="Permanent link">&para;</a></h2>
<p>Read through <a href="../../reference/library/#project">project</a> function reference to see how the API works.</p>
<p>There are a number of things to explore further in the tutorials section.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../architecture/" class="btn btn-neutral float-left" title="Architecture"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../getting-started-flakes/" class="btn btn-neutral float-right" title="Getting started with Flakes">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/input-output-hk/haskell.nix" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../../architecture/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../getting-started-flakes/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
